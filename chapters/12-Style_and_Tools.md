# 风格和工具

时间回到Ritchie和Thompson为他们为ACM讨论会准备论文的时候。Brian Kernighan和P.J. Plauger正在合作写*编程风格的要素*(Elements of Programming)。Kernighan说:“我们从1973年开始写，在74年早期结束”。Plauger强调:

> Brian Kernighan和我在莫里山贝尔实验室的隔壁办公室几乎以事故收场...

> 我们怜悯计算机编程的糟糕状态，以商业创作结束。我们都是第一次写作，这一本小书花掉我们差不多4个月的时间。据我所知，它让“编程风格”作为成人间合法的讨论话题出现在书上。

> 当然，这本书现在已经过时的可怕了...

Kernighan告诉Peter Collinson:

> Plauger和我写那本书，过程很有趣，结果也还很不错。那本书背后的思想是列出很多代码然后评论它们:那样做不对，应该有更好的做法。我们不说应该怎么做，而只是说应该不去做什么。我们的目标语言是那时社区的主要语言FORTRAN和PL/I。

*编程风格*引起了很大的轰动。但是不管是Plauger还是Kernighan都强调它只涉及了FORTRAN和PL/I。他们两人合作的下一件工作有着更加深远的影响。Collinson问Kernighan他是怎么开始写*软件工具*(Software Tools)的。他回答说:“这很难说”。

> 几年以后，我们决定是时候去告诉人们一点东西，让他们知道他们应该怎么做事情。那时候，我们清楚的知道一些Unix环境的好处:管道可以让程序在一起协同工作，还可以加上过滤器。还没有一本书清楚了讲解怎么用一个编程语言实现这些。当然，C语言在很多环境里是不存在的。我已经完成了Ratfor(Rational FORTRAN)。Ratfor简单的偷窃了C语言好的一面，但是除此之外并没有添加太多东西。它还算不错，将FORTRAN变成一个编程语言。

> 我们决定用Ratfor作为那本书的编程语言实在是违反传统，因为它只有很少的用户。小组里没有一个人，因为那时没人用FORTRAN语言，除了数值分析员。但他们担心可移植性所以他们不想用Ratfor语言写出无法月的的FORTRAN代码。

> 最初的版本使用C语言用一些yacc的语法写的(**yacc**是“yet another compiler-compiler”的简写，由Steve Johnson编写)。给出自举，它就能花费一些时间用Ratfor语言写出来。之后它能在一个只运行FROTRAN的机器上运行。为了软件工具包分发的一部分程序是用Ratfor实现的Ratfor，还有一部分是用FORTRAN实现的。纸带上开头就是FORTRAN实现的Ratfor，因此你可以简单的拿出纸带开始运行。

Collinson接着问:“那么你有了Ratfor，你是怎么从它们又做到软件包的”?

> 你坐在哪里，然后问Unix系统中有哪些有意思的事情。事实上有很多的小工具你可以将它们用有意思的方式组合在一起工作。书的前三章内容会让你看到:字符输入输出是最通用途径，文本就是一切，数据就是一行一行的流式文本，也许归档也可以算是。

> 然后我们介绍了正则表达式。这些是Unix中非常重要的基本概念。有了这个，接下来的事情就是模式搜索，**grep**家族，还有编辑器。事实上，排序也可以放在这些工具里面，关于算法有很多有趣的算法可以说。

> 我们做的另一件事情是文本格式，一次我们做了一个简单的格式化工具。最后，我们讲解了Ratfor，说这是你可以一直用下去的程序。这是用Ratfor实现的Ratfor。

**软件工具**这本书附带一个Ratfor纸带，Ratfor是为这本书而写。但书实现出版的，Kernighan评论说:

> Ratfor是这本书的基础，但它成了这本书的媒介。书上描述的版本比之带上的版本要简单，因为将它的实现全部解释给你也不会学到更多新的东西。有一些像软件工具小组之类的小组开始出现，主要是在加利福尼亚的劳伦斯伯克利实验室。Debbie Scherrer，Joe Sventek，Dennis Hall还有其他很多人建立起了软件工具小组并且做了很多很棒的工作，比如建立“虚拟操作系统”以及很多其他各种事情。用干净利落的方式在多个平台上使用了优雅的技巧。

再回忆一下Unix的哲学:**写一个程序，只做一件事并把事情做好**。这就是这些工具背后的思想。并且这句话也激发了劳伦斯实验室的人们。

Debbie Scherrer告诉我:

> 如你所知我最初是在太平洋大学。但是他们只有一个计算机课程，所以我转学到了伯克利。大概在1968年我为我的硕士学位工作的时候，在贝尔实验室有一个工作机会，那时一个很棒的工作。Dennis Hall和Joe Sventek就在楼下，他们在另一个部门工作。他的学位是物理学位，并且做的是像武器测试这样的保密工作...我们给这些研究员维护系统，他们只要计算机工作就好，对计算机本书毫不关心。但是有一天来自阿姆斯特丹自由大学的Andy Tanenbaum在实验室的桌子上留下一本复印的*软件工具*，他说“你可能会对这个感兴趣”。所以我开始阅读，觉得这本书简直美妙无比。同时Andy Tanenbaum提到这本书，实验室的Dennis Hall发现了它。Dennis将我拉了进来(那时我在为另一个项目工作)，Dennis是一切的起点，是他在我和Joe能接受的范围内指导我们。从那个周末开始我就坐下来开始完成整本书。这太棒了！Dennis，Joe和我都觉得，如果我们支持研究，那么这些工具也支持研究。我们最后完成了所有剩余部分。喔，还没说完。DOE的Jim Poolet一直非常支持我们，给我们资助。没有人曾经这么做过，独自用可怕的FORTRAN程序，扩展的DCL脚本，还有其他可笑的东西。

它就是那么快。

Mike O'Dell告诉我:“记着，Debbie知道Brian，他知道他们在做什么，所以他指出人们在向贝尔实验室询问什么工具。这些事情慢慢形成了用户组”。说起来，*软件工具*不是一本关于Unix的书，而是关于哲学和风格。Ritchie说:

> 工具的使用简单而强大，但是也需要一些想象力。相比起将更简单，更普通的工具组合在一起，建立一个专用的工具可能需要更加高昂的代价。

有趣的是，Scherrer和他的同事们意识到工具想法是如此强大，他们清楚的知道软件工具的方式会在所有平台上流行起来。所以Hall，Scherrer还有Svented写了一个虚拟操作系统(VOS)，它能在软件工具(Ratfor)和任意的操作系统之间提供一个虚拟的接口。Scherrer谦虚的说:“VOS是Dennis的主意”。

我问Paula Hawthrn，关于软件同居，在贝尔实验室谁有成为O'Dell的主管的声誉。她说:

> 当我加入到贝尔实验室的计算机科学与数学部门，Debbie，Joe还有Dennis Hall已经完成*软件工具*的几个版本，但还困扰于“但这真的是科研吗”这个问题。

> 那个问题是因为贝尔实验室本应该是做科研的，我们能说发布软件工具就是在做研究吗？“但这真的是科研吗”，是真正想做为众人所用的研究的工程师的毒药，因为很多做出成果的事情不需要研究，但是科研如果没有这种基础根本就无从谈起。所以我那时的记忆完全充斥着和“这真的是科研吗”的纠缠，还有“如果你想用Unix，为什么不直接去用Unix”的对抗。大致上，软件工具似乎成了掩盖非Unix系统差异，使他们看起来都和Unix一样。这同样引起很多热烈的讨论...

1978年成立了一个软件工具用户组，用于和一些人讨论工具的问题。1980年9月VOS的文章发布在CACM上，不过一个STUG会议已经于6月16日，在瓦乌布日赫大学先于USENIX会议举办。Wally Wedel在会上报告了LBL主办的非定期通讯杂志*软件工具社区*(1980年10月4日)。在几个DEC操作系统，数据控制网络，TSO环境下的IBM系统，还有MPX 1.3(MPX是一个早期的操作系统，NASA的Ames研究中心虽然能够让每一个工具在它上面工作，却没能实现一个shell)上的SEL 32/77上软件工具都已经可以使用。在1981年9月的那期杂志上，Phil Scherrer(以前的独角兽系统个，现在在斯坦福大学)写文章说:

> 软件工具现在已经完全移植到一个微型计算机环境。运行在8080，Z80(zilog的商标)，8085处理器上的CP/M(数字研究的商标)操作系统因为可以在众多硬件上运行，被选为目标系统。

那一期的*软件工具社区*列出了接近30个已经实现工具的硬件架构和移植者的地址。内容从Burroughs到Zilog的制造商(字母排序)，从Z80/8080(64Kb内存)到IBM 730和DEC 20的机器(大小排序)。地理上看移植者来自全球各地:从日本的川崎到美国，到美国，到加拿大，到英国，再到荷兰的埃因霍温。

工具变得重要的站点之一是佐治亚州科技。在那里呆了很长时间(虽然不是在最开始)的Gene Spafford告诉我:

> 1970年的中后期，佐治亚州科技的人们有几个运行Unix的PDP11。这些机器既被用作科研，也是医学数据库研究程序的一部分。

> 几个学生和员工们被Unix迷住了，他们想把它放在部门的主要科研计算机Prime上。Prime在那时是很好的机器，它有虚拟内存，多用户环境，还有许多很好的特性。不幸的是，Prime的硬件架使得再上面写一个操作系统并不容易，Unix并没有被移植到这台机器。

作为一个附加诱因，最后一台PDP-11被一个DEC驻场工程师“熔掉了”，他弄颠倒了电源，将110伏的电流接到了背板上。DEC再也没有让它恢复正常，所以我们没了Unix...





---
**译者注**

* [Plauger](http://plauger.com/)
* [Ratfor](http://sepwww.stanford.edu/doku.php?id=sep:software:ratfor)
* [Software Tools](https://www.amazon.com/Software-Tools-Brian-W-Kernighan/dp/020103669X)
* [The Elements of Programming Style ](http://www2.ing.unipi.it/~a009435/issw/extra/kp_elems_of_pgmng_sty.pdf)
